- extends "layout.j2.jade"
- from "proposition_macros.j2.jade" import proposition_box, proposition_tabline
- from "argument_macros.j2.jade" import argument_box

- block title
  title= title

- block content
  = proposition_tabline(_model, "discussion")
  = proposition_box(_model, current_user, _("goto_arguments"), no_margin=True, voting=True, details=True, show_actions=True)

  .arguments
    a(name="bottom")

    .proposition_col.pro
      for argument in arguments("pro")
          = argument_box(argument, current_user, show_ca_button=True)

      a(href=new_argument_url("pro")) 
        .button_add_related
          i.fa.fa-thumbs-o-up &nbsp;
          = _("add_pro_argument")

    .proposition_col.con
      for argument in arguments("con")
        = argument_box(argument, current_user, show_ca_button=True)

      a(href=new_argument_url("con")) 
        .button_add_related
          i.fa.fa-thumbs-o-down &nbsp;
          = _("add_con_argument")

- block script
  script.
    $(function() {
      $("[data-action='argument_vote_up']").click(function() {
        var revoke = $(this).data("revoke");
        var argument_id = $(this).data("argument-id");
        Sijax.request("argument_vote", [argument_id, revoke ? 0 : 1]);
      });

      $("[data-action='argument_vote_dn']").click(function() {
        var revoke = $(this).data("revoke");
        var argument_id = $(this).data("argument-id");
        Sijax.request("argument_vote", [argument_id, revoke ? 0 : -1]);
      });

      $("[data-action='proposition_vote']").click(function() {
        var proposition_id = $(this).data("proposition-id");
        Sijax.request("proposition_vote", [proposition_id, 1]);
      });

      $("[data-action='proposition_revoke_vote']").click(function() {
        var proposition_id = $(this).data("proposition-id");
        Sijax.request("proposition_vote", [proposition_id, 0]);
      });
    });


    change_proposition_vote_actions = function(proposition_id, old_value, value) {
      
      vote_btn = $(`[data-action='proposition_vote'][data-proposition-id='${proposition_id}']`);
      revoke_vote_btn = $(`[data-action='proposition_revoke_vote'][data-proposition-id='${proposition_id}']`);

      if (old_value == 0 && value == 1) {
        vote_btn.prop("hidden", "hidden")
        revoke_vote_btn.prop("hidden", false)
      }
      else if (old_value == 1 && value == 0) {
        vote_btn.prop("hidden", false)
        revoke_vote_btn.prop("hidden", "hidden")
      }
    }


    change_argument_vote_actions = function(argument_id, old_value, value) {

      vote_up = $(`[data-action='argument_vote_up'][data-argument-id='${argument_id}']`);
      vote_dn = $(`[data-action='argument_vote_dn'][data-argument-id='${argument_id}']`);

      if (old_value == 0 && value == 1) {
        vote_up.addClass("active");
        vote_up.data("revoke", true);
      }
      else if (old_value == 0 && value == -1) {
        vote_dn.addClass("active");
        vote_dn.data("revoke", true);
      }
      else if (old_value == 1 && value == 0) {
        vote_up.removeClass("active");
        vote_up.data("revoke", false);
      }
      else if (old_value == -1 && value == 0) {
        vote_dn.removeClass("active");
        vote_dn.data("revoke", false);
      }
      else if (old_value == -1 && value == 1) {
        vote_dn.removeClass("active");
        vote_dn.data("revoke", false);
        vote_up.addClass("active");
        vote_up.data("revoke", true);
      }
      else if (old_value == 1 && value == -1) {
        vote_up.removeClass("active");
        vote_up.data("revoke", false);
        vote_dn.addClass("active");
        vote_dn.data("revoke", true);
      }
    };

// generated from jade
//- vim: set filetype=jade sw=2 ts=2 sts=2 expandtab:
